<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="icon" href="https://pfst.cf2.poecdn.net/base/image/9f13b5bbb8f024fa0fd00c3ee6cda118805e32e32405c81d9897a56de1c6fe3d?w=835&h=911">
<link rel="apple-touch-icon" href="https://pfst.cf2.poecdn.net/base/image/9f13b5bbb8f024fa0fd00c3ee6cda118805e32e32405c81d9897a56de1c6fe3d?w=835&h=911">
<title>å€‹äººé€²åº¦è¿½è¹¤</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --pri:#4A90D9;--pri-dk:#2a6cb8;--pri-lt:#EBF3FB;
  --ok:#27AE60;--ok-lt:#E8F8F0;
  --warn:#F39C12;--warn-lt:#FEF5E7;
  --err:#E74C3C;--err-lt:#FDEDEC;
  --grey:#95A5A6;--grey-lt:#F0F3F4;
  --bg:#F5F7FA;--card:#FFF;--text:#2C3E50;--text2:#8E99A4;
  --shadow:0 2px 12px rgba(0,0,0,.05);--r:16px;
  --ring-c:#4facfe;
}
html{-webkit-tap-highlight-color:transparent}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang TC","Microsoft JhengHei",sans-serif;
  background:var(--bg);color:var(--text);line-height:1.6;
  height:100vh;height:100dvh;display:flex;flex-direction:column;overflow:hidden;
}
a{color:var(--pri);text-decoration:none}

/* ===== HEADER ===== */
.header{
  background:linear-gradient(135deg,#4A90D9,#357ABD);
  color:#fff;padding:16px 20px 14px;flex-shrink:0;
  box-shadow:0 2px 16px rgba(42,108,184,.25);
}
.header-title{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:12px}
.header-title img{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,.35)}
.header-title h1{font-size:20px;font-weight:700;letter-spacing:.5px}
.header-row{display:flex;align-items:center;justify-content:center;gap:10px}
.nav-btn{
  width:38px;height:38px;border-radius:50%;border:none;
  background:rgba(255,255,255,.15);color:#fff;font-size:17px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
}
.nav-btn:active{background:rgba(255,255,255,.3)}
.date-disp{
  font-size:17px;font-weight:700;min-width:170px;text-align:center;
  padding:7px 14px;border-radius:10px;background:rgba(255,255,255,.12);
  position:relative;
}
.date-disp input[type="date"]{position:absolute;inset:0;opacity:0;cursor:pointer;font-size:16px;width:100%}
.today-btn{font-size:13px!important;width:auto!important;padding:0 14px!important;border-radius:20px!important;white-space:nowrap;font-weight:600}
.day-type-row{display:flex;justify-content:center;gap:10px;margin-top:12px}
.day-type-btn{
  padding:6px 22px;border-radius:22px;border:2px solid rgba(255,255,255,.3);
  background:transparent;color:rgba(255,255,255,.6);font-size:14px;font-weight:600;
  cursor:pointer;transition:all .2s;
}
.day-type-btn.active-work{background:rgba(255,255,255,.95);color:var(--pri);border-color:transparent}
.day-type-btn.active-rest{background:#2ECC71;color:#fff;border-color:transparent}

/* ===== TABS ===== */
.tab-area{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:20px 16px 24px}
.tab-pane{display:none;max-width:480px;margin:0 auto}
.tab-pane.active{display:block}

/* ===== BOTTOM NAV ===== */
.bottom-nav{
  flex-shrink:0;background:#fff;
  box-shadow:0 -1px 8px rgba(0,0,0,.06);
  border-top:1px solid rgba(0,0,0,.04);
  display:flex;justify-content:center;
  padding:8px 0 4px;
  padding-bottom:max(12px,calc(env(safe-area-inset-bottom) + 8px));
}
.nav-item{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:4px 0 2px;cursor:pointer;color:#999;font-size:10px;font-weight:500;
  transition:color .2s;border:none;background:none;gap:2px;
  width:60px;position:relative;letter-spacing:.3px;
}
.nav-item .ni{font-size:22px;line-height:1.2;filter:grayscale(1);opacity:.55;transition:all .2s}
.nav-item.active{color:#222;font-weight:700}
.nav-item.active .ni{filter:grayscale(0);opacity:1}
.nav-item.active::after{
  content:'';position:absolute;top:-8px;left:50%;transform:translateX(-50%);
  width:20px;height:3px;border-radius:2px;background:#222;
}

/* ===== CARDS ===== */
.card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);margin-bottom:16px;padding:22px 20px}
.card h3{font-size:17px;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.sec-info{font-size:14px;color:var(--text2);margin-bottom:14px;line-height:1.7}

/* ===== TECH PROGRESS ===== */
.tech-card{
  background:linear-gradient(145deg,#0c1229,#162042);
  border-radius:20px;padding:30px 20px 28px;margin-bottom:16px;
  position:relative;overflow:hidden;box-shadow:0 4px 24px rgba(0,0,0,.2);
}
.tech-card::before{
  content:'';position:absolute;inset:0;
  background-image:linear-gradient(rgba(79,172,254,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(79,172,254,.03) 1px,transparent 1px);
  background-size:28px 28px;pointer-events:none;
}
.tech-ring-wrap{position:relative;width:200px;height:200px;margin:0 auto}
.tech-svg{width:100%;height:100%}
#progRing{transition:stroke-dashoffset .8s ease,stroke .5s ease;filter:drop-shadow(0 0 10px var(--ring-c))}
.scan-wrap{position:absolute;top:50%;left:50%;width:0;height:0;pointer-events:none}
.scan-line{
  position:absolute;top:-1px;left:0;width:88px;height:2px;
  background:linear-gradient(90deg,transparent,var(--ring-c));
  animation:scan 4s linear infinite;opacity:.5;
}
@keyframes scan{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.tech-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.tech-pct{font-size:46px;font-weight:800;color:#fff;text-shadow:0 0 24px var(--ring-c)}
.tech-detail{font-size:15px;color:rgba(255,255,255,.45);margin-top:4px;letter-spacing:.5px}
.particle{
  position:absolute;width:4px;height:4px;border-radius:50%;
  background:var(--ring-c);animation:pfloat 3s ease-in-out infinite;pointer-events:none;
}
@keyframes pfloat{0%,100%{transform:translateY(0) scale(.8);opacity:.2}50%{transform:translateY(-12px) scale(1.4);opacity:.8}}

/* ===== OVERVIEW GRID ===== */
.ov-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
.ov-card{
  background:var(--card);border-radius:14px;box-shadow:var(--shadow);
  padding:20px 14px 18px;cursor:pointer;transition:transform .15s;
  display:flex;flex-direction:column;align-items:center;text-align:center;
}
.ov-card:active{transform:scale(.96)}
.ov-icon{font-size:32px;margin-bottom:6px}
.ov-title{font-size:13px;color:var(--text2);margin-bottom:6px;letter-spacing:.3px}
.ov-val{font-size:22px;font-weight:800}
.ov-bar{width:100%;height:5px;background:#f0f2f5;border-radius:3px;margin-top:10px;overflow:hidden}
.ov-bar-fill{height:100%;border-radius:3px;transition:width .4s}
.ov-full{grid-column:1/-1}

/* ===== ACT ===== */
.act-dots{display:flex;gap:14px;justify-content:center;margin:18px 0}
.act-dot{
  width:54px;height:54px;border-radius:50%;border:3px solid var(--pri);
  background:#fff;cursor:pointer;transition:all .2s;
  display:flex;align-items:center;justify-content:center;font-size:22px;color:transparent;
}
.act-dot.filled{background:var(--pri);color:#fff;border-color:var(--pri-dk);box-shadow:0 3px 12px rgba(74,144,217,.35)}
.act-dot:active{transform:scale(.88)}
.act-lbl{text-align:center;font-size:34px;font-weight:800;color:var(--pri)}
.act-sub{text-align:center;font-size:14px;color:var(--text2);margin-bottom:6px}
.act-tools{margin-top:18px;background:var(--pri-lt);border-radius:14px;overflow:hidden}
.act-tools summary{padding:14px 18px;cursor:pointer;font-size:15px;font-weight:600;color:var(--pri-dk)}
.act-tools ol{padding:0 18px 16px 36px;font-size:14px}
.act-tools li{margin-bottom:10px;line-height:1.7}
.act-tools strong{color:var(--pri-dk)}

/* ===== EXERCISES ===== */
.ex-item{display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid #f2f3f5}
.ex-item:last-child{border-bottom:none}
.ex-info{flex:1;min-width:0}
.ex-name{font-size:16px;font-weight:700;display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.ex-target{font-size:13px;color:var(--text2);margin-top:3px}
.set-ctr{display:flex;align-items:center;gap:10px;flex-shrink:0}
.set-ctr button{
  width:40px;height:40px;border-radius:50%;border:2px solid var(--pri);
  background:#fff;color:var(--pri);font-size:20px;font-weight:700;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
}
.set-ctr button:active{background:var(--pri);color:#fff}
.set-ctr .cnt{min-width:32px;text-align:center;font-size:20px;font-weight:800}
.opt-toggle{margin-top:10px}
.opt-toggle summary{cursor:pointer;font-size:15px;color:var(--pri);font-weight:600;padding:14px 0}

/* ===== TIMER ===== */
.timer-card{
  background:linear-gradient(145deg,#1a1a2e,#16213e);
  border-radius:20px;padding:26px 20px;color:#fff;margin-bottom:16px;
  box-shadow:0 4px 20px rgba(0,0,0,.2);text-align:center;
}
.timer-card h3{color:#fff;justify-content:center;font-size:20px;margin-bottom:8px}
.round-dots{display:flex;gap:10px;justify-content:center;margin:14px 0}
.rd{width:14px;height:14px;border-radius:50%;background:rgba(255,255,255,.12);transition:all .3s}
.rd.filled{background:var(--ok);box-shadow:0 0 8px rgba(39,174,96,.5)}
.rd.current{background:var(--warn);animation:rdpulse 1s infinite}
@keyframes rdpulse{0%,100%{box-shadow:0 0 4px rgba(243,156,18,.4)}50%{box-shadow:0 0 14px rgba(243,156,18,.8)}}
.tm-ring-wrap{position:relative;width:180px;height:180px;margin:14px auto}
.tm-svg{width:100%;height:100%}
#tmRing{transition:stroke-dashoffset .3s ease,stroke .3s ease}
.tm-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.tm-phase{font-size:18px;font-weight:700;transition:color .3s}
.tm-countdown{font-size:56px;font-weight:800;line-height:1}
.tm-round{font-size:14px;color:rgba(255,255,255,.5);margin-top:6px}
.tm-btns{display:flex;gap:12px;justify-content:center;margin-top:20px}
.tm-btns .btn{min-width:110px;font-size:16px;padding:12px 0}
.jj-manual{margin-top:20px;padding-top:18px;border-top:1px solid rgba(255,255,255,.08)}
.jj-manual-label{font-size:13px;color:rgba(255,255,255,.35);margin-bottom:10px}
.jj-ctr{display:flex;align-items:center;justify-content:center;gap:16px}
.jj-ctr button{
  width:46px;height:46px;border-radius:50%;border:2px solid rgba(255,255,255,.2);
  background:transparent;color:#fff;font-size:22px;font-weight:700;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
}
.jj-ctr button:active{background:rgba(255,255,255,.1)}
.jj-val{font-size:28px;font-weight:800;min-width:80px;text-align:center}
.jj-val span{color:rgba(255,255,255,.45);font-size:16px;font-weight:400}

/* ===== SUPPLEMENTS ===== */
.supp-grp{margin-bottom:20px}.supp-grp:last-child{margin-bottom:0}
.supp-hdr{font-size:15px;font-weight:700;color:var(--text2);margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid #eef0f2}
.supp-item{display:flex;align-items:flex-start;gap:12px;padding:12px 0;border-bottom:1px solid #f8f9fa}
.supp-item:last-child{border-bottom:none}
.supp-chk input{display:none}
.supp-chk label{
  display:flex;width:32px;height:32px;border-radius:10px;border:2px solid #d5d9de;
  cursor:pointer;align-items:center;justify-content:center;font-size:16px;
  color:transparent;transition:all .2s;margin-top:2px;flex-shrink:0;
}
.supp-chk input:checked+label{background:var(--ok);border-color:var(--ok);color:#fff}
.supp-det{flex:1;min-width:0}
.supp-nm{font-size:15px;font-weight:700;display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.supp-meta{font-size:13px;color:var(--text2);margin-top:3px}
.pri-badge{display:inline-block;font-size:11px;padding:2px 8px;border-radius:8px;font-weight:700}
.pri-must{background:var(--err-lt);color:var(--err)}
.pri-bonus{background:var(--warn-lt);color:var(--warn)}
.pri-opt{background:var(--grey-lt);color:var(--grey)}

/* ===== MEALS ===== */
.meal-grp{margin-bottom:20px}.meal-grp:last-child{margin-bottom:0}
.meal-grp label{display:block;font-size:16px;font-weight:700;margin-bottom:8px}
.meal-grp textarea{
  width:100%;min-height:100px;border:2px solid #e8eaed;border-radius:14px;
  padding:14px 16px;font-size:16px;font-family:inherit;resize:vertical;
  transition:border-color .2s,background .2s;line-height:1.6;background:#fafbfd;
}
.meal-grp textarea:focus{outline:none;border-color:var(--pri);background:#fff}

/* ===== BUTTONS ===== */
.btn{
  padding:14px 20px;border:none;border-radius:14px;font-size:16px;font-weight:700;
  cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;
  transition:all .15s;width:100%;
}
.btn:active{transform:scale(.97)}
.btn-pri{background:var(--pri);color:#fff}
.btn-ok{background:var(--ok);color:#fff}
.btn-row{display:flex;gap:12px;margin-bottom:12px}
.btn-row .btn{flex:1}

/* ===== MODAL ===== */
.modal-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:300;align-items:center;justify-content:center;padding:24px}
.modal-ov.show{display:flex}
.modal-box{background:#fff;border-radius:20px;padding:30px;max-width:340px;width:100%;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,.18)}
.modal-box h3{margin-bottom:14px;font-size:20px}
.modal-box p{font-size:15px;color:var(--text2);margin-bottom:22px}
.modal-btns{display:flex;gap:10px}.modal-btns .btn{flex:1}
.qr-btn{
  padding:6px 14px;border-radius:20px;border:1.5px solid #ddd;background:#fafafa;
  font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .15s;
}
.qr-btn:active{background:var(--pri);color:#fff;border-color:var(--pri)}

/* ===== TOAST ===== */
.toast{
  position:fixed;top:12px;left:50%;transform:translateX(-50%);z-index:200;
  background:var(--ok);color:#fff;padding:8px 20px;border-radius:24px;
  font-size:14px;font-weight:600;opacity:0;transition:opacity .3s;pointer-events:none;
}
.toast.show{opacity:1}
</style>
</head>
<body>
<div class="toast" id="toast">âœ“ å·²å„²å­˜</div>

<!-- HEADER -->
<div class="header">
  <div class="header-title">
    <img src="https://pfst.cf2.poecdn.net/base/image/9f13b5bbb8f024fa0fd00c3ee6cda118805e32e32405c81d9897a56de1c6fe3d?w=835&h=911" alt="icon">
    <h1>å€‹äººé€²åº¦è¿½è¹¤</h1>
  </div>
  <div class="header-row">
    <button class="nav-btn" onclick="changeDate(-1)">â—€</button>
    <div class="date-disp"><span id="dateText"></span><input type="date" id="datePicker" onchange="jumpToDate(this.value)"></div>
    <button class="nav-btn" onclick="changeDate(1)">â–¶</button>
    <button class="nav-btn today-btn" onclick="goToday()">ä»Šå¤©</button>
  </div>
  <div class="day-type-row">
    <button class="day-type-btn" id="btnWork" onclick="setDayType('work')">ğŸ’¼ ä¸Šç­æ—¥</button>
    <button class="day-type-btn" id="btnRest" onclick="setDayType('rest')">ğŸŒ´ ä¼‘æ¯æ—¥</button>
  </div>
</div>

<!-- TAB AREA -->
<div class="tab-area" id="tabArea">

<!-- OVERVIEW -->
<div class="tab-pane active" id="pOverview">
  <div class="tech-card" id="techCard">
    <div class="tech-ring-wrap">
      <svg viewBox="0 0 200 200" class="tech-svg">
        <circle cx="100" cy="100" r="82" fill="none" stroke="rgba(79,172,254,.08)" stroke-width="10"/>
        <circle id="progRing" cx="100" cy="100" r="82" fill="none"
          stroke="var(--ring-c)" stroke-width="10" stroke-linecap="round"
          stroke-dasharray="515.22" stroke-dashoffset="515.22"
          transform="rotate(-90 100 100)"/>
      </svg>
      <div class="scan-wrap"><div class="scan-line"></div></div>
      <div class="tech-center">
        <div class="tech-pct" id="techPct">0%</div>
        <div class="tech-detail" id="techDetail">0 / 0 å®Œæˆ</div>
      </div>
    </div>
  </div>
  <div class="ov-grid" id="ovGrid"></div>
  <div class="card">
    <h3>ğŸ“Š åŒ¯å‡ºèˆ‡å‚™ä»½</h3>
    <div class="btn-row"><button class="btn btn-pri" onclick="showExportModal()">ğŸ“Š åŒ¯å‡º Excel</button></div>
    <div class="btn-row"><button class="btn btn-ok" onclick="exportBackup()">ğŸ’¾ å‚™ä»½å…¨éƒ¨ JSON</button></div>
    <div class="btn-row" style="margin-bottom:0"><button class="btn" style="background:#f0f0f0;color:var(--text)" onclick="document.getElementById('importFile').click()">ğŸ“‚ åŒ¯å…¥ JSON é‚„åŸ</button></div>
    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importBackup(this)">
  </div>
</div>

<!-- ACT -->
<div class="tab-pane" id="pACT">
  <div class="card">
    <h3>ğŸ§  æ­£å¿µæ³¨æ„åŠ›è¨“ç·´ + ACT</h3>
    <p class="sec-info">ç›®æ¨™ï¼šå¤–é¢å‡ºç¾ â†’ æ‹‰è¿”å°‘å°‘å…¥é¢ï¼Œæ…¢æ…¢ç”± 20% â†’ 40% â†’ 60%</p>
    <div class="act-lbl" id="actLbl">0 / 5</div>
    <div class="act-sub">é»æ“Šåœ“åœˆè¨˜éŒ„æ‹‰å›æ¬¡æ•¸</div>
    <div class="act-dots" id="actDots"></div>
    <div class="act-tools"><details>
      <summary>ğŸ“– æ‹‰å›æµç¨‹æé†’</summary>
      <ol>
        <li><strong>å·¥å…· Aï¼šå‘½åï¼ˆ1ç§’ï¼‰</strong><br>ã€Œå“¦ï¼Œç›£æ§æ¨¡å¼åˆé–‹å’—ã€‚ã€</li>
        <li><strong>å·¥å…· Bï¼šéŒ¨é»ï¼ˆ10-20ç§’ï¼‰</strong><br>æ€ä¸€å€‹èº«é«”ä½ç½®åšéŒ¨ï¼šè…³åº• / æ‰‹æŒ‡ / èƒŒè„Šè²¼æ¤…<br>ï¼ˆåªéœ€è¦ã€Œæ„Ÿè¦ºåˆ°ã€ä½¢ï¼Œå””ä½¿æ”¾é¬†ï¼‰</li>
        <li><strong>å·¥å…· Cï¼šå›æ”¶å‹•ä½œï¼ˆ5ç§’ï¼‰</strong><br>è¼•å£“è…³è¶¾ / æ‰‹æŒ‡æä¸€ä¸‹ / è‚©å‘å¾Œæ”¶ä¸€ä¸‹<br>ä¿¾å¤§è…¦ä¸€å€‹ã€Œé¡é ­è¿”åšŸã€å˜…ä¿¡è™Ÿ</li>
      </ol>
    </details></div>
  </div>
</div>

<!-- CORE -->
<div class="tab-pane" id="pCore">
  <div class="card">
    <h3>ğŸ’ª æ ¸å¿ƒè¨“ç·´</h3>
    <p class="sec-info">å»ºè­°æ™‚é–“ï¼š11:30 - 12:30ï¼ˆæ¯å¤©ï¼‰</p>
    <div id="mainEx"></div>
    <details class="opt-toggle"><summary>ğŸ“‹ å¯é¸å‹•ä½œ</summary><div id="optEx"></div></details>
  </div>
</div>

<!-- JUMPING JACKS -->
<div class="tab-pane" id="pJJ">
  <div class="timer-card">
    <h3>ğŸƒ é–‹åˆè·³è¨ˆæ™‚å™¨</h3>
    <p style="font-size:13px;color:rgba(255,255,255,.4);margin-bottom:6px">20ç§’è·³ â†’ 40ç§’ä¼‘æ¯ â†’ 8è¼ª</p>
    <div class="round-dots" id="roundDots"></div>
    <div class="tm-ring-wrap">
      <svg viewBox="0 0 200 200" class="tm-svg">
        <circle cx="100" cy="100" r="85" fill="none" stroke="rgba(255,255,255,.06)" stroke-width="8"/>
        <circle id="tmRing" cx="100" cy="100" r="85" fill="none"
          stroke="rgba(255,255,255,.12)" stroke-width="8" stroke-linecap="round"
          stroke-dasharray="534" stroke-dashoffset="0"
          transform="rotate(-90 100 100)"/>
      </svg>
      <div class="tm-center">
        <div class="tm-phase" id="tmPhase">æº–å‚™å°±ç·’</div>
        <div class="tm-countdown" id="tmCount">20</div>
        <div class="tm-round" id="tmRound">0 / 8 è¼ª</div>
      </div>
    </div>
    <div class="tm-btns">
      <button id="tmStartBtn" class="btn btn-ok" onclick="tmStart()" style="min-width:110px">â–¶ é–‹å§‹</button>
      <button id="tmPauseBtn" class="btn" style="background:var(--warn);color:#fff;display:none;min-width:110px" onclick="tmPause()">â¸ æš«åœ</button>
      <button id="tmStopBtn" class="btn" style="background:rgba(231,76,60,.9);color:#fff;display:none;min-width:110px" onclick="tmStop()">â¹ çµæŸ</button>
    </div>
    <div class="jj-manual">
      <div class="jj-manual-label">â”€â”€ æ‰‹å‹•èª¿æ•´ â”€â”€</div>
      <div class="jj-ctr">
        <button onclick="adjJJ(-1)">âˆ’</button>
        <div class="jj-val"><span id="jjCount">0</span><span> / 8 è¼ª</span></div>
        <button onclick="adjJJ(1)">+</button>
      </div>
    </div>
  </div>
</div>

<!-- SUPPLEMENTS -->
<div class="tab-pane" id="pSupp">
  <div class="card" style="padding-bottom:12px">
    <h3>ğŸ’Š ä¿å¥å“æœç”¨ <span style="font-size:14px;color:var(--text2);font-weight:400" id="suppBadge">0/14</span></h3>
    <div id="suppList"></div>
  </div>
</div>

<!-- MEALS -->
<div class="tab-pane" id="pMeals">
  <div class="card">
    <h3>ğŸ½ï¸ é£²é£Ÿè¨˜éŒ„</h3>
    <div class="meal-grp"><label>ğŸŒ åˆé¤</label><textarea id="mLunch" placeholder="è¨˜éŒ„åˆé¤å…§å®¹..." oninput="onMeal()"></textarea></div>
    <div class="meal-grp"><label>ğŸŒ™ æ™šé¤</label><textarea id="mDinner" placeholder="è¨˜éŒ„æ™šé¤å…§å®¹..." oninput="onMeal()"></textarea></div>
    <div class="meal-grp"><label>ğŸŒƒ å®µå¤œ</label><textarea id="mLate" placeholder="è¨˜éŒ„å®µå¤œå…§å®¹..." oninput="onMeal()"></textarea></div>
  </div>
</div>

</div><!-- /tab-area -->

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="nav-item active" data-tab="pOverview" onclick="switchTab('pOverview',this)"><span class="ni">ğŸ“Š</span>ç¸½è¦½</button>
  <button class="nav-item" data-tab="pACT" onclick="switchTab('pACT',this)"><span class="ni">ğŸ§ </span>æ­£å¿µ</button>
  <button class="nav-item" data-tab="pCore" onclick="switchTab('pCore',this)"><span class="ni">ğŸ’ª</span>æ ¸å¿ƒ</button>
  <button class="nav-item" data-tab="pJJ" onclick="switchTab('pJJ',this)"><span class="ni">ğŸƒ</span>é–‹åˆè·³</button>
  <button class="nav-item" data-tab="pSupp" onclick="switchTab('pSupp',this)"><span class="ni">ğŸ’Š</span>ä¿å¥</button>
  <button class="nav-item" data-tab="pMeals" onclick="switchTab('pMeals',this)"><span class="ni">ğŸ½ï¸</span>é£²é£Ÿ</button>
</nav>

<!-- EXPORT MODAL -->
<div class="modal-ov" id="exportModal"><div class="modal-box">
  <h3>ğŸ“Š åŒ¯å‡ºå ±è¡¨</h3>
  <p style="font-size:14px;color:var(--text2);margin-bottom:14px">é¸æ“‡åŒ¯å‡ºçš„æ—¥æœŸç¯„åœ</p>
  <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:20px">
    <div style="display:flex;align-items:center;gap:10px;justify-content:center"><span style="font-size:14px;font-weight:600;min-width:36px">å¾</span><input type="date" id="expFrom" style="font-size:16px;padding:10px 14px;border-radius:12px;border:2px solid #e0e0e0;font-family:inherit;flex:1"></div>
    <div style="display:flex;align-items:center;gap:10px;justify-content:center"><span style="font-size:14px;font-weight:600;min-width:36px">åˆ°</span><input type="date" id="expTo" style="font-size:16px;padding:10px 14px;border-radius:12px;border:2px solid #e0e0e0;font-family:inherit;flex:1"></div>
  </div>
  <div style="display:flex;gap:8px;margin-bottom:12px;justify-content:center;flex-wrap:wrap">
    <button class="qr-btn" onclick="setExpRange('week')">æœ¬é€±</button>
    <button class="qr-btn" onclick="setExpRange('month')">æœ¬æœˆ</button>
    <button class="qr-btn" onclick="setExpRange('lastmonth')">ä¸Šæœˆ</button>
    <button class="qr-btn" onclick="setExpRange('all')">å…¨éƒ¨</button>
  </div>
  <div class="modal-btns"><button class="btn btn-pri" onclick="doExport()">åŒ¯å‡º Excel</button><button class="btn" style="background:#eee" onclick="hideModal('exportModal')">å–æ¶ˆ</button></div>
</div></div>

<script>
/* ================================================================ DATA ================================================================ */
const MAIN_EX=[
  {id:'deadbug',name:'æ­»èŸ²å¼ Dead Bug',target:'æ¯çµ„ â†’ ä¼‘æ¯45ç§’ â†’ å…±3çµ„',vid:'https://youtu.be/PxUJ9jJ18tY?si=deZSvw_mcBlGmvEe'},
  {id:'birddog',name:'é³¥ç‹—å¼ Bird-Dog',target:'æ¯çµ„ â†’ ä¼‘æ¯45ç§’ â†’ å…±3çµ„',vid:'https://www.youtube.com/watch?v=vRYf25I6uYo'},
  {id:'glutebridge',name:'è‡€æ©‹ Glute Bridge',target:'æ¯çµ„ â†’ ä¼‘æ¯60ç§’ â†’ å…±3çµ„',vid:'https://youtu.be/abP4ZFSc6Vs?si=9tMLOpNJSTkq8xqZ'},
  {id:'plank',name:'å¹³æ¿æ’ Plankï¼ˆè†è“‹ï¼‰',target:'æ¯çµ„ â†’ ä¼‘æ¯60ç§’ â†’ å…±3çµ„',vid:null},
];
const OPT_EX=[
  {id:'catcow',name:'è²“ç‰›å¼ Cat-Cow',target:'20æ¬¡ï¼ˆç†±èº«ï¼‰',vid:'https://youtu.be/nGFe2xwdTB8?si=4_aD0leUd7kxC0Q1'},
  {id:'toetap',name:'ä»°è‡¥é»åœ° Toe Tap',target:'æ¯çµ„ â†’ ä¼‘æ¯45ç§’ â†’ å…±3çµ„',vid:null},
  {id:'clamshell',name:'å´è‡¥èšŒæ®¼å¼ Clamshell',target:'æ¯é‚Š15æ¬¡ â†’ ä¼‘æ¯30ç§’ â†’ 2çµ„',vid:'https://www.youtube.com/watch?v=rESyd6azAnY'},
  {id:'wallpelvic',name:'é ç‰†éª¨ç›†å¾Œå‚¾',target:'10ç§’Ã—5æ¬¡',vid:'https://www.youtube.com/watch?v=sK5BV55tdjA'},
  {id:'officestretch',name:'ä¸Šç­ä¼¸å±•æ“',target:'è·Ÿå½±ç‰‡',vid:'https://www.youtube.com/watch?v=kGHLpF7OmHk&t=11s'},
];
const SUPPS=[
  {id:'zinc_am',time:'10:30',name:'é‹…è‚Œè‚½ PepZin GI',brand:"Doctor's Best",dose:'2ç²’(16mgé‹…)',pri:'must',note:'ç©ºè…¹é»é™„èƒƒå£ä¿®å¾©',grp:'morning'},
  {id:'probiotic',time:'10:50',name:'ç›Šç”ŸèŒ',brand:'G-NiiB MX XTRA',dose:'1åŒ…',pri:'bonus',note:'ä¿®å¾©è…¸é“èŒç¾¤',grp:'morning'},
  {id:'nac',time:'11:30',name:'NACç·©é‡‹',brand:'Jarrow Sustain',dose:'1ç²’(600mg)',pri:'bonus',note:'è­·è‚æ’æ¯’+è°·æ°¨é…¸èª¿ç¯€',grp:'morning'},
  {id:'vitc',time:'12:30',name:'ç¶­Cç·©è¡å‹',brand:'NOW C-1000',dose:'1ç²’(1000mg)',pri:'bonus',note:'è£œèƒƒç‚æ¶ˆè€—+å¢å¼·éµå¸æ”¶',grp:'morning'},
  {id:'milkthistle',time:'12:30',name:'æ°´é£›è–Šç´ ',brand:'Jarrow Milk Thistle',dose:'2ç²’(240mg)',pri:'bonus',note:'è‚ç´°èƒä¿è­·',grp:'morning'},
  {id:'maca',time:'12:30',name:'é¦¬å¡',brand:'NOW Raw Maca 750mg',dose:'1ç²’(4500mgç­‰æ•ˆ)',pri:'optional',note:'æŠ—ç–²å‹ï¼ˆè©¦ç”¨2é€±è©•ä¼°ï¼‰',grp:'morning'},

  {id:'bcomplex',time:'17:30',name:'Bç¾¤',brand:'Thorne Basic B',dose:'1ç²’',pri:'must',note:'P5Påˆæˆè¡€æ¸…ç´ ',grp:'afternoon'},
  {id:'fishoil',time:'19:00',name:'é­šæ²¹',brand:'GNC Triple Strength',dose:'1ç²’(1000mgÏ‰-3)',pri:'must',note:'EPAæŠ—æŠ‘é¬±+ä¿è­·èƒƒé»è†œ',grp:'evening'},
  {id:'d3',time:'19:00',name:'D3',brand:'NatureWise',dose:'å®¶5000IU/å…¬å¸2000IU',pri:'must',note:'è£œä¸­ç­é›¶æ—¥ç…§',grp:'evening'},
  {id:'k2',time:'19:00',name:'K2 MK-7',brand:'NOW MenaQ7\u00ae',dose:'1ç²’(100mcg)',pri:'bonus',note:'D3æ­æª”ï¼ŒæŒ‡æ®éˆ£å…¥éª¨',grp:'evening'},
  {id:'copper',time:'19:00',name:'éŠ…',brand:'Solgarè¯åˆéŠ…',dose:'1ç²’(2.5mg)',pri:'bonus',note:'å¹³è¡¡32mgé‹…',grp:'evening'},
  {id:'sertraline',time:'01:50',name:'Sertraline',brand:'Hovid SETROF',dose:'1ç‰‡(50mg)',pri:'must',note:'å®šæµ·ç¥é‡',grp:'bedtime'},
  {id:'magnesium',time:'02:10',name:'ç”˜æ°¨é…¸é‚',brand:"å®¶Solaray/å…¬å¸Doctor's Best",dose:'2ç²’(175-200mg)',pri:'must',note:'åŠ©çœ +æŠ—ç„¦æ…®+è‚Œè‚‰æ”¾é¬†',grp:'bedtime'},
  {id:'zinc_pm',time:'02:10',name:'é‹…è‚Œè‚½ PepZin GIï¼ˆæ™šï¼‰',brand:"Doctor's Best",dose:'2ç²’(16mgé‹…)',pri:'must',note:'ç¡çœ æ·±åº¦ä¿®å¾©èƒƒå£',grp:'bedtime'},
];
const SGRPS=[{k:'morning',l:'â˜€ï¸ æ—©ä¸Š 10:30-12:30'},{k:'afternoon',l:'ğŸŒ¤ï¸ ä¸‹åˆ 14:00-17:30'},{k:'evening',l:'ğŸŒ™ æ™šä¸Š 19:00'},{k:'bedtime',l:'ğŸ˜´ ç¡å‰ 01:50-02:10'}];
const PRI={must:{l:'â­å¿…åƒ',c:'pri-must'},bonus:{l:'åŠ åˆ†',c:'pri-bonus'},optional:{l:'å¯ä¸åƒ',c:'pri-opt'}};
const WK=['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];

/* ================================================================ STATE ================================================================ */
let curDate=new Date(),dd={},saveT=null;
const PFX='tracker_';
let tmSt='idle',tmPh='work',tmSec=20,tmRd=0,tmInt=null,audioCtx=null;

/* ================================================================ INIT ================================================================ */
document.addEventListener('DOMContentLoaded',()=>{
  buildACT();buildExercises();buildSupps();buildRoundDots();buildParticles();populateExpSel();
  loadAndRender();
  const ts=dStr(new Date());
  if(!localStorage.getItem(PFX+ts))localStorage.setItem(PFX+ts,JSON.stringify(getDef()));
});

/* ================================================================ TABS ================================================================ */
function switchTab(id,btn){
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('tabArea').scrollTop=0;
}

/* ================================================================ DATE ================================================================ */
function dStr(d){return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`}
function dCN(d){return`${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}ï¼ˆ${WK[d.getDay()]}ï¼‰`}
function changeDate(n){curDate.setDate(curDate.getDate()+n);loadAndRender()}
function goToday(){curDate=new Date();loadAndRender()}
function jumpToDate(v){if(!v)return;const p=v.split('-');curDate=new Date(+p[0],+p[1]-1,+p[2]);loadAndRender()}

/* ================================================================ DATA ================================================================ */
function getDef(){
  const d={dayType:'work',act:0,core:{},jj:0,supplements:{},meals:{lunch:'',dinner:'',latenight:''}};
  [...MAIN_EX,...OPT_EX].forEach(e=>d.core[e.id]=0);
  SUPPS.forEach(s=>d.supplements[s.id]=false);
  return d;
}
function loadDay(ds){
  const raw=localStorage.getItem(PFX+ds),def=getDef();
  if(!raw)return def;
  try{const p=JSON.parse(raw);for(const k in def){if(p[k]===undefined)p[k]=def[k];if(typeof def[k]==='object'&&!Array.isArray(def[k]))for(const s in def[k])if(p[k][s]===undefined)p[k][s]=def[k][s];}return p;}catch{return def;}
}
function save(){
  clearTimeout(saveT);
  saveT=setTimeout(()=>{
    localStorage.setItem(PFX+dStr(curDate),JSON.stringify(dd));
    const el=document.getElementById('toast');el.textContent='âœ“ å·²å„²å­˜';el.style.background='';
    el.classList.add('show');setTimeout(()=>el.classList.remove('show'),800);
  },250);
}
function loadAndRender(){
  dd=loadDay(dStr(curDate));
  document.getElementById('dateText').textContent=dCN(curDate);
  document.getElementById('datePicker').value=dStr(curDate);
  renderAll();
}

/* ================================================================ RENDER ================================================================ */
function renderAll(){renderDayType();renderACT();renderEx();renderJJ();renderSupps();renderMeals();renderProgress();}
function getStats(){
  let t=0,d=0;
  t++;if(dd.act>0)d++;
  MAIN_EX.forEach(e=>{t++;if((dd.core[e.id]||0)>0)d++;});
  t++;if(dd.jj>0)d++;
  SUPPS.forEach(s=>{t++;if(dd.supplements[s.id])d++;});
  ['lunch','dinner','latenight'].forEach(m=>{t++;if((dd.meals[m]||'').trim())d++;});
  return{t,d,pct:t>0?Math.round(d/t*100):0};
}
function renderDayType(){
  document.getElementById('btnWork').className='day-type-btn'+(dd.dayType==='work'?' active-work':'');
  document.getElementById('btnRest').className='day-type-btn'+(dd.dayType==='rest'?' active-rest':'');
}
function renderACT(){
  const c=dd.act||0;
  document.getElementById('actLbl').textContent=`${c} / 5`;
  document.querySelectorAll('.act-dot').forEach((dot,i)=>{dot.classList.toggle('filled',i<c);dot.textContent=i<c?'âœ“':'';});
}
function renderEx(){[...MAIN_EX,...OPT_EX].forEach(e=>{const el=document.getElementById('c_'+e.id);if(el)el.textContent=dd.core[e.id]||0;});}
function renderJJ(){document.getElementById('jjCount').textContent=dd.jj||0;}
function renderSupps(){
  let ck=0;SUPPS.forEach(s=>{const cb=document.getElementById('s_'+s.id);if(cb){cb.checked=!!dd.supplements[s.id];if(cb.checked)ck++;}});
  document.getElementById('suppBadge').textContent=`${ck}/${SUPPS.length}`;
}
function renderMeals(){
  document.getElementById('mLunch').value=dd.meals.lunch||'';
  document.getElementById('mDinner').value=dd.meals.dinner||'';
  document.getElementById('mLate').value=dd.meals.latenight||'';
}
function renderProgress(){
  const{t,d,pct}=getStats();
  /* --- Tech ring (the ONLY progress display now) --- */
  const ring=document.getElementById('progRing');
  ring.style.strokeDashoffset=515.22*(1-pct/100);
  let rc;
  if(pct<25)rc='#ff4757';else if(pct<50)rc='#ffa502';else if(pct<75)rc='#4facfe';else if(pct<100)rc='#2ed573';else rc='#ffd700';
  document.getElementById('techCard').style.setProperty('--ring-c',rc);
  document.getElementById('techPct').textContent=pct+'%';
  document.getElementById('techPct').style.textShadow=`0 0 24px ${rc}`;
  document.getElementById('techDetail').textContent=`${d} / ${t} å®Œæˆ`;
  /* --- Overview grid cards --- */
  const actD=dd.act||0;
  let coreD=0;MAIN_EX.forEach(e=>{if((dd.core[e.id]||0)>0)coreD++;});
  const jjD=dd.jj||0;
  let suppD=0;SUPPS.forEach(s=>{if(dd.supplements[s.id])suppD++;});
  let mealD=0;['lunch','dinner','latenight'].forEach(m=>{if((dd.meals[m]||'').trim())mealD++;});
  const cards=[
    {icon:'ğŸ§ ',title:'æ­£å¿µ ACT',val:`${actD}/5`,pct2:actD/5*100,color:'var(--pri)',tab:'pACT'},
    {icon:'ğŸ’ª',title:'æ ¸å¿ƒè¨“ç·´',val:`${coreD}/${MAIN_EX.length}`,pct2:coreD/MAIN_EX.length*100,color:'#E67E22',tab:'pCore'},
    {icon:'ğŸƒ',title:'é–‹åˆè·³',val:`${jjD}/8 è¼ª`,pct2:jjD/8*100,color:'#9B59B6',tab:'pJJ'},
    {icon:'ğŸ’Š',title:'ä¿å¥å“',val:`${suppD}/${SUPPS.length}`,pct2:suppD/SUPPS.length*100,color:'var(--ok)',tab:'pSupp'},
    {icon:'ğŸ½ï¸',title:'é£²é£Ÿè¨˜éŒ„',val:`${mealD}/3`,pct2:mealD/3*100,color:'#F39C12',tab:'pMeals'},
  ];
  const g=document.getElementById('ovGrid');g.innerHTML='';
  cards.forEach((c,i)=>{
    const el=document.createElement('div');
    el.className='ov-card'+(i===cards.length-1&&cards.length%2===1?' ov-full':'');
    el.onclick=()=>{const b=document.querySelector(`.nav-item[data-tab="${c.tab}"]`);if(b)switchTab(c.tab,b);};
    el.innerHTML=`<div class="ov-icon">${c.icon}</div><div class="ov-title">${c.title}</div><div class="ov-val">${c.val}</div><div class="ov-bar"><div class="ov-bar-fill" style="width:${Math.min(c.pct2,100)}%;background:${c.color}"></div></div>`;
    g.appendChild(el);
  });
}

/* ================================================================ BUILD ================================================================ */
function buildACT(){const c=document.getElementById('actDots');for(let i=0;i<5;i++){const d=document.createElement('div');d.className='act-dot';d.addEventListener('click',()=>{dd.act=dd.act===i+1?i:i+1;renderACT();renderProgress();save();});c.appendChild(d);}}
function mkEx(ex){
  const d=document.createElement('div');d.className='ex-item';
  const v=ex.vid?`<a href="${ex.vid}" target="_blank" rel="noopener">ğŸ¬</a>`:'';
  d.innerHTML=`<div class="ex-info"><div class="ex-name">${ex.name} ${v}</div><div class="ex-target">${ex.target}</div></div><div class="set-ctr"><button onclick="adjEx('${ex.id}',-1)">âˆ’</button><div class="cnt" id="c_${ex.id}">0</div><button onclick="adjEx('${ex.id}',1)">+</button></div>`;
  return d;
}
function buildExercises(){const m=document.getElementById('mainEx');MAIN_EX.forEach(e=>m.appendChild(mkEx(e)));const o=document.getElementById('optEx');OPT_EX.forEach(e=>o.appendChild(mkEx(e)));}
function buildSupps(){
  const con=document.getElementById('suppList');
  SGRPS.forEach(g=>{
    const items=SUPPS.filter(s=>s.grp===g.k);if(!items.length)return;
    const gd=document.createElement('div');gd.className='supp-grp';
    gd.innerHTML=`<div class="supp-hdr">${g.l}</div>`;
    items.forEach(s=>{
      const p=PRI[s.pri];const it=document.createElement('div');it.className='supp-item';
      it.innerHTML=`<div class="supp-chk"><input type="checkbox" id="s_${s.id}" onchange="onSupp('${s.id}',this.checked)"><label for="s_${s.id}">âœ“</label></div><div class="supp-det"><div class="supp-nm">${s.name} <span class="pri-badge ${p.c}">${p.l}</span></div><div class="supp-meta">${s.time} ï½œ ${s.brand} ï½œ ${s.dose}</div><div class="supp-meta" style="color:#aaa">${s.note}</div></div>`;
      gd.appendChild(it);
    });con.appendChild(gd);
  });
}
function buildRoundDots(){const c=document.getElementById('roundDots');for(let i=0;i<8;i++){const d=document.createElement('span');d.className='rd';c.appendChild(d);}}
function buildParticles(){
  const w=document.getElementById('techCard');
  [{t:'12%',l:'8%',d:'0s'},{t:'20%',l:'88%',d:'.6s'},{t:'75%',l:'10%',d:'1.3s'},{t:'80%',l:'85%',d:'2s'},{t:'45%',l:'4%',d:'.3s'},{t:'50%',l:'92%',d:'1.7s'}].forEach(p=>{
    const d=document.createElement('div');d.className='particle';d.style.cssText=`top:${p.t};left:${p.l};animation-delay:${p.d}`;w.appendChild(d);
  });
}

/* ================================================================ INTERACTIONS ================================================================ */
function setDayType(t){dd.dayType=t;renderDayType();renderProgress();save();}
function adjEx(id,n){dd.core[id]=Math.max(0,(dd.core[id]||0)+n);renderEx();renderProgress();save();}
function adjJJ(n){dd.jj=Math.max(0,Math.min(20,(dd.jj||0)+n));renderJJ();renderProgress();save();}
function onSupp(id,v){dd.supplements[id]=v;renderSupps();renderProgress();save();}
function onMeal(){dd.meals.lunch=document.getElementById('mLunch').value;dd.meals.dinner=document.getElementById('mDinner').value;dd.meals.latenight=document.getElementById('mLate').value;renderProgress();save();}

/* ================================================================ TIMER ================================================================ */
function initAudio(){if(!audioCtx)try{audioCtx=new(window.AudioContext||window.webkitAudioContext)();}catch(e){}}
function beep(f,d){if(!audioCtx)return;try{const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=f;g.gain.value=.2;o.start();setTimeout(()=>o.stop(),d);}catch(e){}}
function tmStart(){
  initAudio();
  if(tmSt==='idle'||tmSt==='done'){tmRd=0;tmPh='work';tmSec=20;}
  tmSt='running';tmInt=setInterval(tmTick,1000);renderTimer();
}
function tmPause(){tmSt='paused';clearInterval(tmInt);renderTimer();}
function tmStop(){clearInterval(tmInt);tmSt='idle';dd.jj=tmRd;renderTimer();renderJJ();renderProgress();save();}
function tmTick(){
  tmSec--;
  if(tmSec<0){
    if(tmPh==='work'){
      tmRd++;beep(880,200);
      if(tmRd>=8){clearInterval(tmInt);tmSt='done';dd.jj=8;beep(1200,400);setTimeout(()=>beep(1400,400),500);renderTimer();renderJJ();renderProgress();save();return;}
      tmPh='rest';tmSec=40;
    }else{tmPh='work';tmSec=20;beep(660,150);}
  }
  renderTimer();
}
function renderTimer(){
  document.querySelectorAll('.rd').forEach((d,i)=>{d.className='rd';if(i<tmRd)d.classList.add('filled');else if(i===tmRd&&tmSt==='running')d.classList.add('current');});
  const ce=document.getElementById('tmCount'),pe=document.getElementById('tmPhase'),ring=document.getElementById('tmRing');
  ce.textContent=tmSec;
  document.getElementById('tmRound').textContent=`${tmRd} / 8 è¼ª`;
  if(tmSt==='idle'){pe.textContent='æº–å‚™å°±ç·’';pe.style.color='rgba(255,255,255,.5)';ring.style.stroke='rgba(255,255,255,.12)';ring.style.strokeDashoffset='0';}
  else if(tmSt==='done'){pe.textContent='ğŸ‰ å®Œæˆï¼';pe.style.color='#ffd700';ring.style.stroke='#ffd700';ring.style.strokeDashoffset='0';ring.style.filter='drop-shadow(0 0 12px #ffd700)';}
  else if(tmSt==='paused'){pe.textContent='â¸ æš«åœä¸­';pe.style.color='#F39C12';ring.style.stroke='#F39C12';}
  else if(tmPh==='work'){pe.textContent='ğŸ”¥ è·³ï¼';pe.style.color='#2ECC71';ring.style.stroke='#2ECC71';ring.style.filter='drop-shadow(0 0 8px rgba(46,204,113,.5))';}
  else{pe.textContent='ğŸ’¤ ä¼‘æ¯';pe.style.color='#3498DB';ring.style.stroke='#3498DB';ring.style.filter='drop-shadow(0 0 8px rgba(52,152,219,.5))';}
  if(tmSt==='running'||tmSt==='paused'){const tot=tmPh==='work'?20:40;ring.style.strokeDashoffset=534*(1-tmSec/tot);}
  const sb=document.getElementById('tmStartBtn'),pb=document.getElementById('tmPauseBtn'),xb=document.getElementById('tmStopBtn');
  if(tmSt==='idle'){sb.style.display='';sb.textContent='â–¶ é–‹å§‹';pb.style.display='none';xb.style.display='none';}
  else if(tmSt==='done'){sb.style.display='';sb.textContent='ğŸ”„ å†ä¾†ä¸€æ¬¡';pb.style.display='none';xb.style.display='none';}
  else if(tmSt==='running'){sb.style.display='none';pb.style.display='';xb.style.display='';}
  else if(tmSt==='paused'){sb.style.display='';sb.textContent='â–¶ ç¹¼çºŒ';pb.style.display='none';xb.style.display='';}
}

/* ================================================================ MODALS ================================================================ */
function hideModal(id){document.getElementById(id).classList.remove('show');}
function showExportModal(){
  const now=new Date(),y=now.getFullYear(),m=now.getMonth();
  document.getElementById('expFrom').value=`${y}-${String(m+1).padStart(2,'0')}-01`;
  document.getElementById('expTo').value=dStr(now);
  document.getElementById('exportModal').classList.add('show');
}
function setExpRange(type){
  const now=new Date(),y=now.getFullYear(),m=now.getMonth();
  let from,to;
  if(type==='week'){const d=new Date(now);d.setDate(d.getDate()-d.getDay());from=dStr(d);to=dStr(now);}
  else if(type==='month'){from=`${y}-${String(m+1).padStart(2,'0')}-01`;to=dStr(now);}
  else if(type==='lastmonth'){const lm=m===0?11:m-1,ly=m===0?y-1:y;const dim=new Date(ly,lm+1,0).getDate();from=`${ly}-${String(lm+1).padStart(2,'0')}-01`;to=`${ly}-${String(lm+1).padStart(2,'0')}-${String(dim).padStart(2,'0')}`;}
  else if(type==='all'){let earliest=dStr(now);for(let i=0;i<localStorage.length;i++){const k=localStorage.key(i);if(k.startsWith(PFX)){const ds=k.slice(PFX.length);if(ds<earliest)earliest=ds;}}from=earliest;to=dStr(now);}
  document.getElementById('expFrom').value=from;document.getElementById('expTo').value=to;
}

/* ================================================================ EXPORT ================================================================ */
function populateExpSel(){}
function doExport(){
  const fromStr=document.getElementById('expFrom').value,toStr=document.getElementById('expTo').value;
  if(!fromStr||!toStr){return;}
  const h=['æ—¥æœŸ','æ˜ŸæœŸ','ä¸Šç­/ä¼‘æ¯','ACTæ‹‰å›(X/5)'];
  MAIN_EX.forEach(e=>h.push(e.name+'(çµ„)'));h.push('é–‹åˆè·³(è¼ª)');
  SUPPS.forEach(s=>h.push(s.name));h.push('åˆé¤','æ™šé¤','å®µå¤œ');
  const rows=[h];
  const cur=new Date(fromStr+'T00:00:00'),end=new Date(toStr+'T00:00:00');
  while(cur<=end){
    const ds=dStr(cur),data=loadDay(ds),dow=WK[cur.getDay()];
    const r=[`${cur.getMonth()+1}/${cur.getDate()}`,dow,data.dayType==='rest'?'ä¼‘æ¯æ—¥':'ä¸Šç­æ—¥',data.act||0];
    MAIN_EX.forEach(e=>r.push(data.core[e.id]||0));r.push(data.jj||0);
    SUPPS.forEach(s=>r.push(data.supplements[s.id]?'âœ“':''));
    r.push(data.meals.lunch||'',data.meals.dinner||'',data.meals.latenight||'');rows.push(r);
    cur.setDate(cur.getDate()+1);
  }
  const ws=XLSX.utils.aoa_to_sheet(rows);
  ws['!cols']=h.map((c,i)=>{if(i<2)return{wch:6};if(i===2)return{wch:8};if(c.includes('åˆé¤')||c.includes('æ™šé¤')||c.includes('å®µå¤œ'))return{wch:30};return{wch:Math.max(c.length*1.8,8)};});
  const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,`${fromStr}~${toStr}`);
  XLSX.writeFile(wb,`é€²åº¦è¿½è¹¤_${fromStr}_${toStr}.xlsx`);hideModal('exportModal');
}
function exportBackup(){
  const bk={};for(let i=0;i<localStorage.length;i++){const k=localStorage.key(i);if(k.startsWith(PFX))try{bk[k]=JSON.parse(localStorage.getItem(k));}catch{}}
  const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([JSON.stringify(bk,null,2)],{type:'application/json'}));
  a.download=`é€²åº¦è¿½è¹¤_å‚™ä»½_${dStr(new Date())}.json`;a.click();
}
function importBackup(input){
  const file=input.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const data=JSON.parse(e.target.result);
      let count=0;
      for(const k in data){if(k.startsWith(PFX)){localStorage.setItem(k,JSON.stringify(data[k]));count++;}}
      loadAndRender();
      const el=document.getElementById('toast');el.textContent=`âœ“ å·²é‚„åŸ ${count} å¤©è¨˜éŒ„`;el.style.background=el.style.background;
      el.classList.add('show');setTimeout(()=>el.classList.remove('show'),1500);
    }catch(err){
      const el=document.getElementById('toast');el.textContent='âŒ æª”æ¡ˆæ ¼å¼éŒ¯èª¤';el.style.background='#E74C3C';
      el.classList.add('show');setTimeout(()=>{el.classList.remove('show');el.style.background='';},2000);
    }
  };
  reader.readAsText(file);
  input.value='';
}
</script>
</body>
</html>